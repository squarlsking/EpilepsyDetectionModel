# ğŸ¯ ç±»åˆ«ä¸å¹³è¡¡å¿«é€ŸæŒ‡å—

## ğŸ“Š **ä½ çš„æ•°æ®æƒ…å†µ**

```
é—´æ­‡æœŸï¼ˆlabel=0ï¼‰: 14,777 æ ·æœ¬ (99.13%)
é¢„å‘ä½œæœŸï¼ˆlabel=1ï¼‰: 120 æ ·æœ¬ (0.80%)
å‘ä½œæœŸï¼ˆlabel=2ï¼‰: 10 æ ·æœ¬ (0.07%)
```

**ä¸å¹³è¡¡æ¯”ä¾‹**: çº¦ **1477:12:1** ï¼ˆæåº¦ä¸å¹³è¡¡ï¼ï¼‰

---

## ğŸš€ **æ¨èæ–¹æ¡ˆï¼ˆä»æ˜“åˆ°éš¾ï¼‰**

### âœ… **æ–¹æ¡ˆ 1: ç„¦ç‚¹æŸå¤±ï¼ˆæœ€æ¨èï¼‰**

```bash
# ä¸€é”®è®­ç»ƒ
python scripts/train_xcm_imbalanced.py \
  --csv data/processed/test_with_seizures.csv \
  --output models/xcm_focal \
  --use-focal-loss \
  --epochs 50
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨å…³æ³¨å›°éš¾æ ·æœ¬
- âœ… é€‚åˆæåº¦ä¸å¹³è¡¡ï¼ˆ99:1ï¼‰
- âœ… ç»å…¸ç®—æ³•ï¼ˆYOLOã€RetinaNet éƒ½ç”¨ï¼‰
- â±ï¸ è®­ç»ƒæ—¶é—´: æ­£å¸¸

**é¢„æœŸæ•ˆæœ**: Macro F1 ~ 0.60-0.70

---

### âš¡ **æ–¹æ¡ˆ 2: åŠ æƒæŸå¤±ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰**

```bash
python scripts/train_xcm_imbalanced.py \
  --csv data/processed/test_with_seizures.csv \
  --output models/xcm_weighted \
  --epochs 30
```

**ç‰¹ç‚¹**:
- âœ… å®ç°ç®€å•
- âœ… è®­ç»ƒé€Ÿåº¦æœ€å¿«
- âš ï¸ æ•ˆæœç¨å¼±äºç„¦ç‚¹æŸå¤±

**é¢„æœŸæ•ˆæœ**: Macro F1 ~ 0.50-0.60

---

### ğŸ”¥ **æ–¹æ¡ˆ 3: ç„¦ç‚¹æŸå¤± + SMOTEï¼ˆæ•°æ®å°‘æ—¶ï¼‰**

```bash
python scripts/train_xcm_imbalanced.py \
  --csv data/processed/test_with_seizures.csv \
  --output models/xcm_focal_smote \
  --use-focal-loss \
  --use-smote \
  --epochs 50
```

**ç‰¹ç‚¹**:
- âœ… å¢åŠ å°‘æ•°ç±»æ ·æœ¬
- âœ… é€‚åˆæ ·æœ¬é‡ < 5,000
- âš ï¸ å¯èƒ½è¿‡æ‹Ÿåˆ
- â±ï¸ è®­ç»ƒæ—¶é—´: è¾ƒé•¿

**é¢„æœŸæ•ˆæœ**: Macro F1 ~ 0.65-0.75

---

## ğŸ“ˆ **æ•ˆæœå¯¹æ¯”ï¼ˆé¢„æµ‹ï¼‰**

| æ–¹æ³• | Interictal | Preictal | Ictal | Macro F1 |
|------|-----------|----------|-------|----------|
| æ— ä¼˜åŒ– | 0.99 | 0.00 | 0.00 | 0.33 âŒ |
| åŠ æƒæŸå¤± | 0.95 | 0.45 | 0.30 | 0.57 âœ… |
| **ç„¦ç‚¹æŸå¤±** | 0.94 | 0.58 | 0.42 | **0.65** â­ |
| ç„¦ç‚¹+SMOTE | 0.92 | 0.62 | 0.48 | 0.67 âœ…âœ… |

---

## ğŸ“ **è¯„ä¼°æŒ‡æ ‡ï¼ˆé‡è¦ï¼ï¼‰**

### âŒ **ä¸è¦åªçœ‹ Accuracy**
```
æ¨¡å‹å…¨é¢„æµ‹ä¸º 0 â†’ Accuracy = 99%  # çœ‹èµ·æ¥å¾ˆé«˜ï¼Œå®é™…å•¥ä¹Ÿæ²¡å­¦
```

### âœ… **åº”è¯¥çœ‹çš„æŒ‡æ ‡**

1. **F1 Scoreï¼ˆæ¯ä¸ªç±»åˆ«ï¼‰**
   ```python
   F1 = 2 * (Precision * Recall) / (Precision + Recall)
   ```

2. **Macro F1ï¼ˆæ•´ä½“æ•ˆæœï¼‰**
   ```python
   Macro F1 = (F1_class0 + F1_class1 + F1_class2) / 3
   ```

3. **æ··æ·†çŸ©é˜µ**
   ```
                Pred 0  Pred 1  Pred 2
   True 0 (é—´æ­‡)   4500     50       0
   True 1 (é¢„å‘)     30     60       10
   True 2 (å‘ä½œ)      2      3        5
   ```

4. **AUPRCï¼ˆæœ€é‡è¦ï¼ï¼‰**
   - PR æ›²çº¿ä¸‹é¢ç§¯
   - é€‚åˆæåº¦ä¸å¹³è¡¡

---

## ğŸ”§ **è°ƒå‚æŒ‡å—**

### Focal Loss Gamma
```python
# æ ¹æ®ä¸å¹³è¡¡ç¨‹åº¦é€‰æ‹©
ä¸å¹³è¡¡ 10:1   â†’ gamma=1.0
ä¸å¹³è¡¡ 100:1  â†’ gamma=2.0  â­ æ¨è
ä¸å¹³è¡¡ 1000:1 â†’ gamma=3.0
```

### è®­ç»ƒè½®æ•°
```bash
# å¿«é€Ÿæµ‹è¯•
--epochs 10

# æ­£å¸¸è®­ç»ƒ
--epochs 50  â­ æ¨è

# å……åˆ†è®­ç»ƒ
--epochs 100
```

### æ‰¹å¤§å°
```bash
# GPU æ˜¾å­˜å°
--batch-size 16

# æ­£å¸¸
--batch-size 64  â­ æ¨è

# GPU æ˜¾å­˜å¤§
--batch-size 128
```

---

## ğŸ’¡ **å¸¸è§é—®é¢˜**

### Q: ä¸ºä»€ä¹ˆ Macro F1 åªæœ‰ 0.6ï¼Ÿ
**A**: 
- å°‘æ•°ç±»æ ·æœ¬å¤ªå°‘ï¼ˆlabel=2 åªæœ‰ 10 ä¸ªï¼‰
- è¿™å·²ç»æ˜¯ä¸é”™çš„ç»“æœï¼
- å¯å°è¯•ï¼š
  1. æ”¶é›†æ›´å¤šå‘ä½œæœŸæ•°æ®
  2. ä½¿ç”¨ SMOTE è¿‡é‡‡æ ·
  3. æ”¹ä¸ºäºŒåˆ†ç±»ï¼ˆåˆå¹¶ label=1 å’Œ label=2ï¼‰

---

### Q: è®­ç»ƒæ—¶ loss ä¸ä¸‹é™ï¼Ÿ
**A**:
1. æ£€æŸ¥å­¦ä¹ ç‡ï¼ˆlr_find è‡ªåŠ¨å¯»æ‰¾ï¼‰
2. å¢åŠ è®­ç»ƒè½®æ•°
3. é™ä½ focal_gammaï¼ˆå¦‚ 1.5ï¼‰

---

### Q: è¿‡é‡‡æ ·åå†…å­˜ä¸è¶³ï¼Ÿ
**A**:
1. ä¸ä½¿ç”¨ SMOTEï¼ˆå»æ‰ --use-smoteï¼‰
2. å‡å°æ‰¹å¤§å°ï¼ˆ--batch-size 16ï¼‰
3. åªå¯¹è®­ç»ƒé›†è¿‡é‡‡æ ·ï¼Œä¸å¯¹éªŒè¯é›†

---

## ğŸ¯ **å®Œæ•´æµç¨‹ç¤ºä¾‹**

```bash
# 1. å¤„ç†æ•°æ®ï¼ˆå‰ 10 ä¸ªå—è¯•è€…ï¼‰
python scripts/prepare_dataset_xcm.py \
  --data-dir data/raw/ds005873-download \
  --output data/processed/seizure_10sub.csv \
  --max-subjects 10

# 2. è®­ç»ƒæ¨¡å‹ï¼ˆç„¦ç‚¹æŸå¤±ï¼‰
python scripts/train_xcm_imbalanced.py \
  --csv data/processed/seizure_10sub.csv \
  --output models/xcm_focal_10sub \
  --use-focal-loss \
  --epochs 50 \
  --batch-size 64

# 3. æŸ¥çœ‹ç»“æœ
ls models/xcm_focal_10sub/
# model.pkl              - è®­ç»ƒå¥½çš„æ¨¡å‹
# confusion_matrix.png   - æ··æ·†çŸ©é˜µå¯è§†åŒ–
# results.json           - è¯¦ç»†è¯„ä¼°æŒ‡æ ‡
```

---

## ğŸ“š **æ›´å¤šç»†èŠ‚**

è¯¦ç»†æ–‡æ¡£: [`docs/IMBALANCED_LEARNING.md`](./IMBALANCED_LEARNING.md)

- ç„¦ç‚¹æŸå¤±åŸç†
- SMOTE è¿‡é‡‡æ ·æœºåˆ¶
- è¯„ä¼°æŒ‡æ ‡è¯¦è§£
- è®ºæ–‡å‚è€ƒ

---

## âœ¨ **æ€»ç»“**

1. **é¦–é€‰æ–¹æ¡ˆ**: ç„¦ç‚¹æŸå¤±ï¼ˆ--use-focal-lossï¼‰
2. **è¯„ä¼°æŒ‡æ ‡**: F1ã€AUPRCï¼ˆä¸çœ‹ Accuracyï¼‰
3. **æ•°æ®ä¸è¶³**: åŠ ä¸Š --use-smote
4. **é¢„æœŸæ•ˆæœ**: Macro F1 = 0.6-0.7ï¼ˆå·²ç»ä¸é”™ï¼ï¼‰

ğŸš€ **å¼€å§‹è®­ç»ƒå§ï¼**
